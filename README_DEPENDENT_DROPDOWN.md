# คู่มือระบบที่อยู่แบบ Dependent Dropdown

## ความเปลี่ยนแปลงที่ทำ

1. **สร้างฐานข้อมูลที่เกี่ยวข้อง**
   - สร้างตาราง `provinces` (จังหวัด)
   - สร้างตาราง `amphures` (อำเภอ/เขต)
   - สร้างตาราง `districts` (ตำบล/แขวง พร้อมรหัสไปรษณีย์)
   - เพิ่มฟิลด์ที่เกี่ยวข้องกับที่อยู่ในตาราง `employee`

2. **ปรับปรุงหน้าฟอร์มพนักงาน**
   - เปลี่ยนจากการกรอกข้อมูลที่อยู่ในช่อง textarea เป็นการเลือกจากรายการแบบ dropdown
   - เพิ่มการเลือกจังหวัด อำเภอ/เขต ตำบล/แขวง และแสดงรหัสไปรษณีย์อัตโนมัติ
   - แยกส่วนของที่อยู่เป็น "ที่อยู่ปัจจุบัน" และ "ที่อยู่ตามทะเบียนบ้าน"
   - เพิ่มตัวเลือก "ใช้ที่อยู่เดียวกับที่อยู่ปัจจุบัน" เพื่อความสะดวก

3. **เพิ่มความสามารถใน Livewire Component**
   - โหลดรายการจังหวัดเมื่อเริ่มต้นใช้งาน
   - โหลดรายการอำเภอเมื่อเลือกจังหวัด
   - โหลดรายการตำบลเมื่อเลือกอำเภอ
   - แสดงรหัสไปรษณีย์อัตโนมัติเมื่อเลือกตำบล
   
4. **นำเข้าข้อมูลจริงจากไฟล์ SQL**
   - นำเข้าข้อมูลจังหวัดทั้ง 77 จังหวัดของประเทศไทย
   - นำเข้าข้อมูลอำเภอ/เขตในทุกจังหวัด
   - นำเข้าข้อมูลตำบล/แขวงพร้อมรหัสไปรษณีย์
   - ข้อมูลมาจากไฟล์ SQL จริงที่มีการใช้งานในระบบ

## โครงสร้างฐานข้อมูลที่ใช้

1. **โครงสร้างตาราง provinces**
   ```sql
   CREATE TABLE `provinces` (
     `id` bigint(20) NOT NULL,
     `province_name` varchar(255) DEFAULT NULL,
     `province_code` int(11) DEFAULT NULL,
     `created_at` timestamp NULL DEFAULT NULL,
     `updated_at` timestamp NULL DEFAULT NULL
   );
   ```

2. **โครงสร้างตาราง amphures**
   ```sql
   CREATE TABLE `amphures` (
     `id` bigint(20) NOT NULL,
     `amphur_name` varchar(255) DEFAULT NULL,
     `amphur_code` varchar(4) DEFAULT NULL,
     `province_code` int(11) DEFAULT NULL,
     `created_at` timestamp NULL DEFAULT NULL,
     `updated_at` timestamp NULL DEFAULT NULL
   );
   ```

3. **โครงสร้างตาราง districts**
   ```sql
   CREATE TABLE `districts` (
     `id` bigint(20) NOT NULL,
     `district_name` varchar(255) DEFAULT NULL,
     `district_code` varchar(6) DEFAULT NULL,
     `amphur_code` varchar(4) DEFAULT NULL,
     `province_code` int(11) DEFAULT NULL,
     `zipcode` varchar(5) DEFAULT NULL,
     `created_at` timestamp NULL DEFAULT NULL,
     `updated_at` timestamp NULL DEFAULT NULL
   );
   ```

## วิธีการติดตั้ง

1. **เตรียมข้อมูลจังหวัด อำเภอ ตำบล**
   - นำไฟล์ SQL ที่ได้รับมาไว้ในโฟลเดอร์ `database/sql/`
   - ต้องมีไฟล์ต่อไปนี้:
     - `provinces.sql` (ข้อมูลจังหวัด)
     - `amphures.sql` (ข้อมูลอำเภอ)
     - `districts.sql` (ข้อมูลตำบลและรหัสไปรษณีย์)

2. **รันคำสั่ง Migration**
   ```
   php artisan migrate
   ```

3. **รันคำสั่ง Seeder เพื่อนำเข้าข้อมูล**
   ```
   php artisan db:seed --class=GeographicDataSeeder
   ```

## วิธีการใช้งาน

1. **การกรอกที่อยู่ปัจจุบัน**
   - เลือกจังหวัด
   - เมื่อเลือกจังหวัดแล้ว ระบบจะโหลดอำเภอ/เขต ในจังหวัดนั้น
   - เลือกอำเภอ/เขต
   - เมื่อเลือกอำเภอ/เขตแล้ว ระบบจะโหลดตำบล/แขวง ในอำเภอนั้น
   - เลือกตำบล/แขวง
   - รหัสไปรษณีย์จะแสดงโดยอัตโนมัติตามตำบล/แขวงที่เลือก
   - กรอกรายละเอียดที่อยู่เพิ่มเติม (บ้านเลขที่ หมู่บ้าน ซอย ถนน)

2. **การกรอกที่อยู่ตามทะเบียนบ้าน**
   - ถ้าที่อยู่ตามทะเบียนบ้านเหมือนกับที่อยู่ปัจจุบัน ให้คลิกที่ "ใช้ที่อยู่เดียวกับที่อยู่ปัจจุบัน"
   - ถ้าแตกต่างกัน ให้กรอกข้อมูลเหมือนกับส่วนที่อยู่ปัจจุบัน

## หมายเหตุสำหรับผู้ดูแลระบบ

1. **การตั้งค่าในฐานข้อมูล**
   - รหัสไปรษณีย์เก็บอยู่ในตาราง `districts` ไม่ได้แยกเป็นตารางต่างหาก
   - ความสัมพันธ์ระหว่างตารางใช้ฟิลด์ `province_code`, `amphur_code`, `district_code` เป็นคีย์เชื่อมโยง

2. **การใช้งานกับข้อมูลจริง**
   - ระบบถูกปรับแก้เพื่อให้ทำงานกับโครงสร้างข้อมูลที่มีอยู่จริงในไฟล์ SQL ที่แนบมา
   - หากมีการเปลี่ยนแปลงโครงสร้างข้อมูล อาจจำเป็นต้องปรับแก้ Model และ Relation ให้สอดคล้องกัน

3. **ข้อมูลที่อยู่เดิม**
   - ระบบยังคงเก็บข้อมูลที่อยู่แบบเดิมในฟิลด์ `emp_address_current` และ `emp_address_register` เพื่อความเข้ากันได้กับระบบเดิม
   - ข้อมูลเหล่านี้จะถูกสร้างขึ้นอัตโนมัติจากการเลือกที่อยู่ใหม่

4. **การเพิ่มข้อมูลจังหวัด อำเภอ ตำบล**
   - หากต้องการเพิ่มข้อมูลจังหวัด อำเภอ หรือตำบล สามารถเพิ่มในตารางที่เกี่ยวข้องได้โดยตรง
   - ควรรักษาโครงสร้างของรหัส (code) ให้สอดคล้องกับข้อมูลที่มีอยู่แล้ว

## การแก้ไขปัญหาที่พบบ่อย

1. **Dropdown ไม่แสดงข้อมูล**
   - ตรวจสอบว่าได้นำเข้าข้อมูลจังหวัด อำเภอ และตำบลครบถ้วนแล้ว
   - ตรวจสอบความสัมพันธ์ของข้อมูลว่าถูกต้อง (province_code, amphur_code, district_code)

2. **รหัสไปรษณีย์ไม่แสดง**
   - ตรวจสอบว่าข้อมูลในตาราง `districts` มีค่าในฟิลด์ `zipcode` ครบถ้วน

3. **ไม่สามารถบันทึกข้อมูลได้**
   - ตรวจสอบว่าได้กรอกข้อมูลครบถ้วนในฟิลด์ที่จำเป็น โดยเฉพาะฟิลด์ที่มีเครื่องหมาย * กำกับ

## วิธีการนำเข้าข้อมูลจังหวัด อำเภอ ตำบล

1. **ขั้นตอนการนำเข้าข้อมูล**
   - ข้อมูลจริงสำหรับ provinces, amphures และ districts อยู่ในโฟลเดอร์ `database/sql/`
   - ใช้คำสั่ง `php artisan db:seed --class=GeographicDataSeeder` เพื่อนำเข้าข้อมูลทั้งหมด
   - ข้อมูลจะถูกนำเข้าตามลำดับ: provinces -> amphures -> districts

2. **กรณีต้องการปรับแก้หรือเพิ่มเติมข้อมูล**
   - แก้ไขไฟล์ SQL ในโฟลเดอร์ `database/sql/` ให้ตรงตามความต้องการ
   - สั่งรันคำสั่ง `php artisan db:seed --class=GeographicDataSeeder` อีกครั้ง (ข้อมูลเดิมจะถูก truncate ก่อนนำเข้าข้อมูลใหม่)

3. **ข้อมูลที่มีในระบบ**
   - ไฟล์ provinces.sql: มีข้อมูลจังหวัดทั้ง 77 จังหวัดของประเทศไทย
   - ไฟล์ amphures.sql: มีข้อมูลอำเภอ/เขตของจังหวัดต่างๆ (แสดงตัวอย่างอำเภอในกรุงเทพฯ และกระบี่)
   - ไฟล์ districts.sql: มีข้อมูลตำบล/แขวงพร้อมรหัสไปรษณีย์ (แสดงตัวอย่างตำบลในกรุงเทพฯ และกระบี่)

4. **การอัปเดตเป็นข้อมูลจริงทั้งหมด**
   - คุณสามารถแทนที่เนื้อหาในไฟล์ amphures.sql และ districts.sql ด้วยข้อมูลจริงทั้งหมดจากไฟล์ SQL ที่คุณมีอยู่
   - ตรวจสอบให้แน่ใจว่าโครงสร้างของคำสั่ง INSERT ตรงกับที่กำหนดในไฟล์ตัวอย่าง
   - หากมีข้อมูลเป็นจำนวนมาก อาจต้องแบ่งไฟล์หรือปรับแก้ GeographicDataSeeder.php ให้รองรับการนำเข้าข้อมูลขนาดใหญ่
